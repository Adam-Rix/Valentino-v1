openapi: 3.0.0

info:
  title: Описание контрактов детального отчета по питанию
  version: '1.0'

paths:
  /nutrition-report/detail/filters:
    get:
      tags:
        - 'Детальный отчет по питанию'
      summary: Получить фильтры детального отчета
      responses:
        '200':
          description: Успешный ответ с фильтрами детального отчета
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailReportFilters'
  /nutrition-report/detail/table:
    post:
      tags:
        - 'Детальный отчет по питанию'
      summary: Получить таблицу детального отчета
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                filterDateFrom:
                  type: string
                  description: Дата начала периода
                  format: date
                  example: "2025-04-01"
                filterDateTo:
                  type: string
                  description: Дата начала периода
                  format: date
                  example: "2025-04-01"
                filterNutritionTypes:
                  type: array
                  example: [ "breakfast", "breakfast_lunch" ]
                  description: Список типов питания
                  items:
                    type: string
                filterNutritionSubTypes:
                  type: array
                  example: [ "breakfast" ]
                  description: Список подтипов питания
                  items:
                    type: string
                filterNumberCategories:
                  type: array
                  example: ["122", "133"]
                  description: Список категорий
                  items:
                    type: string
                page:
                  type: integer
                  example: 3
                  description: Номер страницы
                  nullable: true
                perPage:
                  type: integer
                  example: 30
                  description: Количество элементов на странице
                  nullable: true
      responses:
        '200':
          description: Успешный ответ с таблицей общего отчета
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailReportTable'

  /nutrition-report/detail/exports:
    post:
      tags:
        - 'Детальный отчет по питанию'
      summary: Экспорт детального отчета
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                filterDateFrom:
                  type: string
                  description: Дата начала периода
                  format: date
                  example: "2025-04-01"
                filterDateTo:
                  type: string
                  description: Дата начала периода
                  format: date
                  example: "2025-04-01"
                filterNutritionTypes:
                  type: array
                  example: [ "breakfast", "breakfast_lunch" ]
                  description: Список типов питания
                  items:
                    type: string
                filterNutritionSubTypes:
                  type: array
                  example: [ "breakfast" ]
                  description: Список подтипов питания
                  items:
                    type: string
                filterNumberCategories:
                  type: array
                  example: [ "122", "133" ]
                  description: Список категорий
                  items:
                    type: string
      responses:
        '200':
          description: Успешный ответ с файлом выгрузки в формате Excel
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary


components:
  schemas:
    DetailReportFilters:
      type: object
      properties:
        data:
          type: array
          items:
            oneOf:
              - type: object
                properties:
                  name:
                    type: string
                    description: Название поля
                    enum:
                      - filterDateFrom
                  defaultValue:
                    type: string
                    description: Дефолтное значение даты
                    format: date
                    example: "2025-04-01"
              - type: object
                properties:
                  name:
                    type: string
                    description: Название поля
                    enum:
                      - filterDateTo
                  defaultValue:
                    type: string
                    description: Дефолтное значение даты
                    format: date
                    example: "2025-04-01"
              - type: object
                properties:
                  name:
                    type: string
                    description: Название поля
                    enum:
                      - filterNutritionTypes
                  options:
                    type: array
                    items:
                      type: object
                      properties:
                        label:
                          type: string
                          description: Название типа питания
                          example: "Завтрак"
                        value:
                          type: string
                          description: Внутреннее значение типа питания
                          example: "breakfast"
              - type: object
                properties:
                  name:
                    type: string
                    description: Название поля
                    enum:
                      - filterNutritionSubTypes
                  options:
                    type: array
                    items:
                      type: object
                      properties:
                        label:
                          type: string
                          description: Название подтипа питания
                          example: "Завтрак"
                        value:
                          type: string
                          description: Внутреннее значение подтипа питания
                          example: "breakfast"
              - type: object
                properties:
                  name:
                    type: string
                    description: Название поля
                    enum:
                      - filterNumberCategories
                  options:
                    type: array
                    items:
                      type: object
                      properties:
                        label:
                          type: string
                          description: Название категории
                          example: "Стандарт 2-х местный"
                        value:
                          type: string
                          description: ID категории
                          example: "122"
                        remark:
                          type: string
                          description: Статус категории
                          enum:
                            - ""
                            - "удалена"
                            - "закрыта"
    DetailReportTable:
      type: object
      properties:
        data:
          type: object
          properties:
            items:
              type: array
              items:
                type: object
                properties:
                  room:
                    type: string
                    description: Номер комнаты
                    example: "222"
                    nullable: true
                  categoryId:
                    type: string
                    description: ID категории
                    example: "122"
                  categoryName:
                    type: string
                    description: Название категории
                    example: "Стандарт 2-х местный"
                  serviceId:
                    type: string
                    description: ID услуги
                    example: "84"
                  orderServiceId:
                    type: string
                    description: ID заказа услуги
                    example: "3484"
                  serviceName:
                    type: string
                    description: Название услуги
                    example: "Питание"
                  nutritionType:
                    type: string
                    description: Название типа питания
                    example: "Полный пансион"
                  nutritionSubtype:
                    type: string
                    description: Название подтипа питания
                    example: "Завтрак"
                  adultCount:
                    type: integer
                    description: Количество взрослых
                    example: 12
                  childCount:
                    type: integer
                    description: Количество детей
                    example: 3
                  totalCount:
                    type: integer
                    description: Количество общее
                    example: 15
                  bookingItemId:
                    type: string
                    description: ID элемента бронирования
                    example: 50599
                  bookingId:
                    type: string
                    description: ID  бронирования
                    example: 2391
                  checkInDate:
                    type: string
                    description: Дата заезда
                    format: date
                    example: "2025-04-01"
                  checkOutDate:
                    type: string
                    description: Дата выезда
                    format: date
                    example: "2025-04-11"
                  guests:
                    type: array
                    description: ФИО гостей
                    items:
                      type: object
                      properties:
                        firstname:
                          type: string
                          description: Имя гостя
                          example: "Иван"
                        lastname:
                          type: string
                          description: Фамилия гостя
                          example: "Иванов"
                        middle:
                          type: string
                          description: Отчество гостя
                          example: "Иванович"
                          nullable: true
        pagination:
          type: object
          properties:
            total:
              type: integer
              description: Всего записей в таблице
              example: 123
            page:
              type: integer
              description: Номер страницы
              example: 3
            lastPage:
              type: integer
              description: Номер последней страницы
              example: 5
            perPage:
              type: integer
              description: Количество записей на странице
              example: 30